{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 63e53acb9b5537fb1270","webpack:///./src/index.js","webpack:///./src/Emitter.js","webpack:///./src/phoenix.js"],"names":["VueChannel","install","Vue","url","params","store","Error","socket","prototype","$socket","mixin","created","connect","channels","$options","Proxy","set","target","key","value","chan","channel","_chan","join","onError","onClose","onJoin","receive","onMessage","event","payload","res","deleteProperty","Object","keys","forEach","beforeDestroy","console","log","leave","listeners","Map","label","callback","vm","has","get","push","index","length","reduce","i","listener","splice","args","call","global","factory","exports","Phoenix","defineProperty","_typeof","Symbol","iterator","obj","constructor","_createClass","defineProperties","props","descriptor","enumerable","configurable","writable","Constructor","protoProps","staticProps","_toConsumableArray","arr","Array","isArray","arr2","from","_classCallCheck","instance","TypeError","VSN","SOCKET_STATES","connecting","open","closing","closed","DEFAULT_TIMEOUT","WS_CLOSE_NORMAL","CHANNEL_STATES","errored","joined","joining","leaving","CHANNEL_EVENTS","close","error","reply","TRANSPORTS","longpoll","websocket","Push","timeout","receivedResp","timeoutTimer","recHooks","sent","resend","cancelRefEvent","ref","refEvent","send","hasReceived","startTimeout","topic","status","response","matchReceive","_ref","filter","h","off","cancelTimeout","clearTimeout","_this","makeRef","replyEventName","on","setTimeout","trigger","Channel","_this2","state","bindings","joinedOnce","joinPush","pushBuffer","rejoinTimer","Timer","rejoinUntilConnected","reconnectAfterMs","reset","pushEvent","joinRef","remove","reason","isLeaving","isClosed","scheduleTimeout","isJoining","isConnected","rejoin","arguments","undefined","bind","canPush","isJoined","_this3","leavePush","isMember","sendJoin","indexOf","handledPayload","map","isErrored","Socket","endPoint","_this4","opts","stateChangeCallbacks","message","sendBuffer","transport","window","WebSocket","LongPoll","defaultEncoder","JSON","stringify","defaultDecoder","parse","encode","decode","heartbeatIntervalMs","tries","logger","longpollerTimeout","heartbeatTimer","pendingHeartbeatRef","reconnectTimer","disconnect","protocol","location","match","endPointURL","uri","Ajax","appendParams","vsn","charAt","host","code","conn","onclose","_this5","onopen","onConnOpen","onerror","onConnError","onmessage","onConnMessage","onConnClose","kind","msg","data","onOpen","_this6","flushSendBuffer","skipHeartbeat","clearInterval","setInterval","sendHeartbeat","triggerChanError","connectionState","readyState","c","chanParams","_this7","result","newRef","toString","rawMessage","_this8","token","pollEndpoint","normalizeEndpoint","poll","replace","RegExp","endpointURL","closeAndRetry","ontimeout","_this9","request","resp","messages","body","_this10","method","accept","XDomainRequest","req","xdomainRequest","_req","XMLHttpRequest","ActiveXObject","xhrRequest","_this11","onload","parseJSON","responseText","onprogress","_this12","setRequestHeader","onreadystatechange","states","complete","e","serialize","parentKey","queryStr","hasOwnProperty","paramKey","paramVal","encodeURIComponent","prefix","Presence","syncState","currentState","newState","onLeave","_this13","clone","joins","leaves","presence","newPresence","currentPresence","newRefs","metas","m","phx_ref","curRefs","joinedMetas","leftMetas","syncDiff","_ref2","_state$key$metas","unshift","apply","leftPresence","refsToRemove","p","list","presences","chooser","pres","func","getOwnPropertyNames","timerCalc","timer","_this14"],"mappings":"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EA,WAASG,kBAAT,CAA4BC,GAA5B,EAAiC;AAAE,QAAIC,MAAMC,OAAN,CAAcF,GAAd,CAAJ,EAAwB;AAAE,WAAK,IAAI1B,IAAI,CAAR,EAAW6B,OAAOF,MAAMD,IAAI5B,MAAV,CAAvB,EAA0CE,IAAI0B,IAAI5B,MAAlD,EAA0DE,GAA1D,EAA+D;AAAE6B,aAAK7B,CAAL,IAAU0B,IAAI1B,CAAJ,CAAV;AAAmB,OAAC,OAAO6B,IAAP;AAAc,KAA7H,MAAmI;AAAE,aAAOF,MAAMG,IAAN,CAAWJ,GAAX,CAAP;AAAyB;AAAE;;AAEnM,WAASK,eAAT,CAAyBC,QAAzB,EAAmCV,WAAnC,EAAgD;AAAE,QAAI,EAAEU,oBAAoBV,WAAtB,CAAJ,EAAwC;AAAE,YAAM,IAAIW,SAAJ,CAAc,mCAAd,CAAN;AAA2D;AAAE;;AAEzJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA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","file":"build.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"VueChannel\"] = factory();\n\telse\n\t\troot[\"VueChannel\"] = factory();\n})(this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 1);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 63e53acb9b5537fb1270","import {Socket} from \"./phoenix\";\n\nimport Emitter from './Emitter'\n\nconst VueChannel = {\n\n    install(Vue, url, params, store){\n\n        if(!url) throw new Error(\"[VueChannel] Cannot connect to an empty URL\")\n\n        // let observer = new Observer(connection, params, store)\n\n        let socket = new Socket(url, {params: params});\n\n        Vue.prototype.$socket = socket;\n        \n        Vue.mixin({\n            created(){\n\n                this.$socket.connect();\n\n                let channels = this.$options['channels']\n                \n                this.$options.channels = new Proxy({}, {\n                    set: (target, key, value) => {\n                        // Emitter.addListener(key, value, this)\n                        \n                        let chan = this.$socket.channel(key, {});\n                        let _chan = chan.join();\n\n                        if(value.onError) {\n                            chan.onError = value.onError;\n                        }\n\n                        if(value.onClose) {\n                            chan.onClose = value.onClose;\n                        }\n                        \n                        if(value.onJoin) {\n                            _chan.receive('ok', value.onJoin);\n                        }\n                        \n                        if(value.onMessage) {\n                            chan.onMessage = function(event, payload, res) {\n                                value.onMessage(event, payload, res)\n                                return payload;\n                            }\n                        }\n                        \n                        target[key] = chan;\n                        return true;\n                    },\n                    deleteProperty: (target, key) => {\n                        // Emitter.removeListener(key, this.$options.channels[key], this)\n                        delete target.key;\n                        return true\n                    }\n                })\n\n                if(channels){\n                    Object.keys(channels).forEach((key) => {\n                        this.$options.channels[key] = channels[key];\n                    });\n                }\n            },\n            beforeDestroy(){\n                let channels = this.$options['channels']\n\n                if(channels){\n                    Object.keys(channels).forEach((key) => {\n                        console.log(\"Bye\", key);\n                        this.$options.channels[key].leave();\n                        delete this.$options.channels[key]\n                    });\n                }\n            }\n        })\n\n    }\n\n}\n\nexport default VueChannel;\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","export default new class {\n    constructor() {\n        this.listeners = new Map();\n    }\n\n    addListener(label, callback, vm) {\n        if(typeof callback == 'function'){\n            this.listeners.has(label) || this.listeners.set(label, []);\n            this.listeners.get(label).push({callback: callback, vm: vm});\n\n            return true\n        }\n\n        return false\n    }\n\n    removeListener(label, callback, vm) {\n        let listeners = this.listeners.get(label),\n            index;\n\n        if (listeners && listeners.length) {\n            index = listeners.reduce((i, listener, index) => {\n                return (typeof listener.callback == 'function' && listener.callback === callback && listener.vm == vm) ?\n                    i = index :\n                    i;\n            }, -1);\n\n            if (index > -1) {\n                listeners.splice(index, 1);\n                this.listeners.set(label, listeners);\n                return true;\n            }\n        }\n        return false;\n    }\n\n    emit(label, ...args) {\n        let listeners = this.listeners.get(label);\n\n        if (listeners && listeners.length) {\n            listeners.forEach((listener) => {\n                listener.callback.call(listener.vm,...args)\n            });\n            return true;\n        }\n        return false;\n    }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/Emitter.js","(function (global, factory) {\ntypeof exports === 'object' ? factory(exports) :\ntypeof define === 'function' && define.amd ? define(['exports'], factory) :\nfactory(global.Phoenix = global.Phoenix || {});\n}(this, (function (exports) {\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n// Phoenix Channels JavaScript client\n//\n// ## Socket Connection\n//\n// A single connection is established to the server and\n// channels are multiplexed over the connection.\n// Connect to the server using the `Socket` class:\n//\n//     let socket = new Socket(\"/ws\", {params: {userToken: \"123\"}})\n//     socket.connect()\n//\n// The `Socket` constructor takes the mount point of the socket,\n// the authentication params, as well as options that can be found in\n// the Socket docs, such as configuring the `LongPoll` transport, and\n// heartbeat.\n//\n// ## Channels\n//\n// Channels are isolated, concurrent processes on the server that\n// subscribe to topics and broker events between the client and server.\n// To join a channel, you must provide the topic, and channel params for\n// authorization. Here's an example chat room example where `\"new_msg\"`\n// events are listened for, messages are pushed to the server, and\n// the channel is joined with ok/error/timeout matches:\n//\n//     let channel = socket.channel(\"room:123\", {token: roomToken})\n//     channel.on(\"new_msg\", msg => console.log(\"Got message\", msg) )\n//     $input.onEnter( e => {\n//       channel.push(\"new_msg\", {body: e.target.val}, 10000)\n//        .receive(\"ok\", (msg) => console.log(\"created message\", msg) )\n//        .receive(\"error\", (reasons) => console.log(\"create failed\", reasons) )\n//        .receive(\"timeout\", () => console.log(\"Networking issue...\") )\n//     })\n//     channel.join()\n//       .receive(\"ok\", ({messages}) => console.log(\"catching up\", messages) )\n//       .receive(\"error\", ({reason}) => console.log(\"failed join\", reason) )\n//       .receive(\"timeout\", () => console.log(\"Networking issue. Still waiting...\") )\n//\n//\n// ## Joining\n//\n// Creating a channel with `socket.channel(topic, params)`, binds the params to\n// `channel.params`, which are sent up on `channel.join()`.\n// Subsequent rejoins will send up the modified params for\n// updating authorization params, or passing up last_message_id information.\n// Successful joins receive an \"ok\" status, while unsuccessful joins\n// receive \"error\".\n//\n// ## Duplicate Join Subscriptions\n//\n// While the client may join any number of topics on any number of channels,\n// the client may only hold a single subscription for each unique topic at any\n// given time. When attempting to create a duplicate subscription,\n// the server will close the existing channel, log a warning, and\n// spawn a new channel for the topic. The client will have their\n// `channel.onClose` callbacks fired for the existing channel, and the new\n// channel join will have its receive hooks processed as normal.\n//\n// ## Pushing Messages\n//\n// From the previous example, we can see that pushing messages to the server\n// can be done with `channel.push(eventName, payload)` and we can optionally\n// receive responses from the push. Additionally, we can use\n// `receive(\"timeout\", callback)` to abort waiting for our other `receive` hooks\n//  and take action after some period of waiting. The default timeout is 5000ms.\n//\n//\n// ## Socket Hooks\n//\n// Lifecycle events of the multiplexed connection can be hooked into via\n// `socket.onError()` and `socket.onClose()` events, ie:\n//\n//     socket.onError( () => console.log(\"there was an error with the connection!\") )\n//     socket.onClose( () => console.log(\"the connection dropped\") )\n//\n//\n// ## Channel Hooks\n//\n// For each joined channel, you can bind to `onError` and `onClose` events\n// to monitor the channel lifecycle, ie:\n//\n//     channel.onError( () => console.log(\"there was an error!\") )\n//     channel.onClose( () => console.log(\"the channel has gone away gracefully\") )\n//\n// ### onError hooks\n//\n// `onError` hooks are invoked if the socket connection drops, or the channel\n// crashes on the server. In either case, a channel rejoin is attempted\n// automatically in an exponential backoff manner.\n//\n// ### onClose hooks\n//\n// `onClose` hooks are invoked only in two cases. 1) the channel explicitly\n// closed on the server, or 2). The client explicitly closed, by calling\n// `channel.leave()`\n//\n//\n// ## Presence\n//\n// The `Presence` object provides features for syncing presence information\n// from the server with the client and handling presences joining and leaving.\n//\n// ### Syncing initial state from the server\n//\n// `Presence.syncState` is used to sync the list of presences on the server\n// with the client's state. An optional `onJoin` and `onLeave` callback can\n// be provided to react to changes in the client's local presences across\n// disconnects and reconnects with the server.\n//\n// `Presence.syncDiff` is used to sync a diff of presence join and leave\n// events from the server, as they happen. Like `syncState`, `syncDiff`\n// accepts optional `onJoin` and `onLeave` callbacks to react to a user\n// joining or leaving from a device.\n//\n// ### Listing Presences\n//\n// `Presence.list` is used to return a list of presence information\n// based on the local state of metadata. By default, all presence\n// metadata is returned, but a `listBy` function can be supplied to\n// allow the client to select which metadata to use for a given presence.\n// For example, you may have a user online from different devices with a\n// a metadata status of \"online\", but they have set themselves to \"away\"\n// on another device. In this case, they app may choose to use the \"away\"\n// status for what appears on the UI. The example below defines a `listBy`\n// function which prioritizes the first metadata which was registered for\n// each user. This could be the first tab they opened, or the first device\n// they came online from:\n//\n//     let state = {}\n//     state = Presence.syncState(state, stateFromServer)\n//     let listBy = (id, {metas: [first, ...rest]}) => {\n//       first.count = rest.length + 1 // count of this user's presences\n//       first.id = id\n//       return first\n//     }\n//     let onlineUsers = Presence.list(state, listBy)\n//\n//\n// ### Example Usage\n//\n//     // detect if user has joined for the 1st time or from another tab/device\n//     let onJoin = (id, current, newPres) => {\n//       if(!current){\n//         console.log(\"user has entered for the first time\", newPres)\n//       } else {\n//         console.log(\"user additional presence\", newPres)\n//       }\n//     }\n//     // detect if user has left from all tabs/devices, or is still present\n//     let onLeave = (id, current, leftPres) => {\n//       if(current.metas.length === 0){\n//         console.log(\"user has left from all devices\", leftPres)\n//       } else {\n//         console.log(\"user left from a device\", leftPres)\n//       }\n//     }\n//     let presences = {} // client's initial empty presence state\n//     // receive initial presence data from server, sent after join\n//     myChannel.on(\"presence_state\", state => {\n//       presences = Presence.syncState(presences, state, onJoin, onLeave)\n//       displayUsers(Presence.list(presences))\n//     })\n//     // receive \"presence_diff\" from server, containing join/leave events\n//     myChannel.on(\"presence_diff\", diff => {\n//       presences = Presence.syncDiff(presences, diff, onJoin, onLeave)\n//       this.setState({users: Presence.list(room.presences, listBy)})\n//     })\n//\nvar VSN = \"1.0.0\";\nvar SOCKET_STATES = { connecting: 0, open: 1, closing: 2, closed: 3 };\nvar DEFAULT_TIMEOUT = 10000;\nvar WS_CLOSE_NORMAL = 1000;\nvar CHANNEL_STATES = {\n  closed: \"closed\",\n  errored: \"errored\",\n  joined: \"joined\",\n  joining: \"joining\",\n  leaving: \"leaving\"\n};\nvar CHANNEL_EVENTS = {\n  close: \"phx_close\",\n  error: \"phx_error\",\n  join: \"phx_join\",\n  reply: \"phx_reply\",\n  leave: \"phx_leave\"\n};\nvar TRANSPORTS = {\n  longpoll: \"longpoll\",\n  websocket: \"websocket\"\n};\n\nvar Push = function () {\n\n  // Initializes the Push\n  //\n  // channel - The Channel\n  // event - The event, for example `\"phx_join\"`\n  // payload - The payload, for example `{user_id: 123}`\n  // timeout - The push timeout in milliseconds\n  //\n  function Push(channel, event, payload, timeout) {\n    _classCallCheck(this, Push);\n\n    this.channel = channel;\n    this.event = event;\n    this.payload = payload || {};\n    this.receivedResp = null;\n    this.timeout = timeout;\n    this.timeoutTimer = null;\n    this.recHooks = [];\n    this.sent = false;\n  }\n\n  _createClass(Push, [{\n    key: \"resend\",\n    value: function resend(timeout) {\n      this.timeout = timeout;\n      this.cancelRefEvent();\n      this.ref = null;\n      this.refEvent = null;\n      this.receivedResp = null;\n      this.sent = false;\n      this.send();\n    }\n  }, {\n    key: \"send\",\n    value: function send() {\n      if (this.hasReceived(\"timeout\")) {\n        return;\n      }\n      this.startTimeout();\n      this.sent = true;\n      this.channel.socket.push({\n        topic: this.channel.topic,\n        event: this.event,\n        payload: this.payload,\n        ref: this.ref\n      });\n    }\n  }, {\n    key: \"receive\",\n    value: function receive(status, callback) {\n      if (this.hasReceived(status)) {\n        callback(this.receivedResp.response);\n      }\n\n      this.recHooks.push({ status: status, callback: callback });\n      return this;\n    }\n\n    // private\n\n  }, {\n    key: \"matchReceive\",\n    value: function matchReceive(_ref) {\n      var status = _ref.status,\n          response = _ref.response,\n          ref = _ref.ref;\n\n      this.recHooks.filter(function (h) {\n        return h.status === status;\n      }).forEach(function (h) {\n        return h.callback(response);\n      });\n    }\n  }, {\n    key: \"cancelRefEvent\",\n    value: function cancelRefEvent() {\n      if (!this.refEvent) {\n        return;\n      }\n      this.channel.off(this.refEvent);\n    }\n  }, {\n    key: \"cancelTimeout\",\n    value: function cancelTimeout() {\n      clearTimeout(this.timeoutTimer);\n      this.timeoutTimer = null;\n    }\n  }, {\n    key: \"startTimeout\",\n    value: function startTimeout() {\n      var _this = this;\n\n      if (this.timeoutTimer) {\n        return;\n      }\n      this.ref = this.channel.socket.makeRef();\n      this.refEvent = this.channel.replyEventName(this.ref);\n\n      this.channel.on(this.refEvent, function (payload) {\n        _this.cancelRefEvent();\n        _this.cancelTimeout();\n        _this.receivedResp = payload;\n        _this.matchReceive(payload);\n      });\n\n      this.timeoutTimer = setTimeout(function () {\n        _this.trigger(\"timeout\", {});\n      }, this.timeout);\n    }\n  }, {\n    key: \"hasReceived\",\n    value: function hasReceived(status) {\n      return this.receivedResp && this.receivedResp.status === status;\n    }\n  }, {\n    key: \"trigger\",\n    value: function trigger(status, response) {\n      this.channel.trigger(this.refEvent, { status: status, response: response });\n    }\n  }]);\n\n  return Push;\n}();\n\nvar Channel = exports.Channel = function () {\n  function Channel(topic, params, socket) {\n    var _this2 = this;\n\n    _classCallCheck(this, Channel);\n\n    this.state = CHANNEL_STATES.closed;\n    this.topic = topic;\n    this.params = params || {};\n    this.socket = socket;\n    this.bindings = [];\n    this.timeout = this.socket.timeout;\n    this.joinedOnce = false;\n    this.joinPush = new Push(this, CHANNEL_EVENTS.join, this.params, this.timeout);\n    this.pushBuffer = [];\n    this.rejoinTimer = new Timer(function () {\n      return _this2.rejoinUntilConnected();\n    }, this.socket.reconnectAfterMs);\n    this.joinPush.receive(\"ok\", function () {\n      _this2.state = CHANNEL_STATES.joined;\n      _this2.rejoinTimer.reset();\n      _this2.pushBuffer.forEach(function (pushEvent) {\n        return pushEvent.send();\n      });\n      _this2.pushBuffer = [];\n    });\n    this.onClose(function () {\n      _this2.rejoinTimer.reset();\n      _this2.socket.log(\"channel\", \"close \" + _this2.topic + \" \" + _this2.joinRef());\n      _this2.state = CHANNEL_STATES.closed;\n      _this2.socket.remove(_this2);\n    });\n    this.onError(function (reason) {\n      if (_this2.isLeaving() || _this2.isClosed()) {\n        return;\n      }\n      _this2.socket.log(\"channel\", \"error \" + _this2.topic, reason);\n      _this2.state = CHANNEL_STATES.errored;\n      _this2.rejoinTimer.scheduleTimeout();\n    });\n    this.joinPush.receive(\"timeout\", function () {\n      if (!_this2.isJoining()) {\n        return;\n      }\n      _this2.socket.log(\"channel\", \"timeout \" + _this2.topic, _this2.joinPush.timeout);\n      _this2.state = CHANNEL_STATES.errored;\n      _this2.rejoinTimer.scheduleTimeout();\n    });\n    this.on(CHANNEL_EVENTS.reply, function (payload, ref) {\n      _this2.trigger(_this2.replyEventName(ref), payload);\n    });\n  }\n\n  _createClass(Channel, [{\n    key: \"rejoinUntilConnected\",\n    value: function rejoinUntilConnected() {\n      this.rejoinTimer.scheduleTimeout();\n      if (this.socket.isConnected()) {\n        this.rejoin();\n      }\n    }\n  }, {\n    key: \"join\",\n    value: function join() {\n      var timeout = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.timeout;\n\n      if (this.joinedOnce) {\n        throw \"tried to join multiple times. 'join' can only be called a single time per channel instance\";\n      } else {\n        this.joinedOnce = true;\n        this.rejoin(timeout);\n        return this.joinPush;\n      }\n    }\n  }, {\n    key: \"onClose\",\n    value: function onClose(callback) {\n      this.on(CHANNEL_EVENTS.close, callback);\n    }\n  }, {\n    key: \"onError\",\n    value: function onError(callback) {\n      this.on(CHANNEL_EVENTS.error, function (reason) {\n        return callback(reason);\n      });\n    }\n  }, {\n    key: \"on\",\n    value: function on(event, callback) {\n      this.bindings.push({ event: event, callback: callback });\n    }\n  }, {\n    key: \"off\",\n    value: function off(event) {\n      this.bindings = this.bindings.filter(function (bind) {\n        return bind.event !== event;\n      });\n    }\n  }, {\n    key: \"canPush\",\n    value: function canPush() {\n      return this.socket.isConnected() && this.isJoined();\n    }\n  }, {\n    key: \"push\",\n    value: function push(event, payload) {\n      var timeout = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : this.timeout;\n\n      if (!this.joinedOnce) {\n        throw \"tried to push '\" + event + \"' to '\" + this.topic + \"' before joining. Use channel.join() before pushing events\";\n      }\n      var pushEvent = new Push(this, event, payload, timeout);\n      if (this.canPush()) {\n        pushEvent.send();\n      } else {\n        pushEvent.startTimeout();\n        this.pushBuffer.push(pushEvent);\n      }\n\n      return pushEvent;\n    }\n\n    // Leaves the channel\n    //\n    // Unsubscribes from server events, and\n    // instructs channel to terminate on server\n    //\n    // Triggers onClose() hooks\n    //\n    // To receive leave acknowledgements, use the a `receive`\n    // hook to bind to the server ack, ie:\n    //\n    //     channel.leave().receive(\"ok\", () => alert(\"left!\") )\n    //\n\n  }, {\n    key: \"leave\",\n    value: function leave() {\n      var _this3 = this;\n\n      var timeout = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.timeout;\n\n      this.state = CHANNEL_STATES.leaving;\n      var onClose = function onClose() {\n        _this3.socket.log(\"channel\", \"leave \" + _this3.topic);\n        _this3.trigger(CHANNEL_EVENTS.close, \"leave\", _this3.joinRef());\n      };\n      var leavePush = new Push(this, CHANNEL_EVENTS.leave, {}, timeout);\n      leavePush.receive(\"ok\", function () {\n        return onClose();\n      }).receive(\"timeout\", function () {\n        return onClose();\n      });\n      leavePush.send();\n      if (!this.canPush()) {\n        leavePush.trigger(\"ok\", {});\n      }\n\n      return leavePush;\n    }\n\n    // Overridable message hook\n    //\n    // Receives all events for specialized message handling\n    // before dispatching to the channel callbacks.\n    //\n    // Must return the payload, modified or unmodified\n\n  }, {\n    key: \"onMessage\",\n    value: function onMessage(event, payload, ref) {\n      return payload;\n    }\n\n    // private\n\n  }, {\n    key: \"isMember\",\n    value: function isMember(topic) {\n      return this.topic === topic;\n    }\n  }, {\n    key: \"joinRef\",\n    value: function joinRef() {\n      return this.joinPush.ref;\n    }\n  }, {\n    key: \"sendJoin\",\n    value: function sendJoin(timeout) {\n      this.state = CHANNEL_STATES.joining;\n      this.joinPush.resend(timeout);\n    }\n  }, {\n    key: \"rejoin\",\n    value: function rejoin() {\n      var timeout = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.timeout;\n      if (this.isLeaving()) {\n        return;\n      }\n      this.sendJoin(timeout);\n    }\n  }, {\n    key: \"trigger\",\n    value: function trigger(event, payload, ref) {\n      var close = CHANNEL_EVENTS.close,\n          error = CHANNEL_EVENTS.error,\n          leave = CHANNEL_EVENTS.leave,\n          join = CHANNEL_EVENTS.join;\n\n      if (ref && [close, error, leave, join].indexOf(event) >= 0 && ref !== this.joinRef()) {\n        return;\n      }\n      var handledPayload = this.onMessage(event, payload, ref);\n      if (payload && !handledPayload) {\n        throw \"channel onMessage callbacks must return the payload, modified or unmodified\";\n      }\n\n      this.bindings.filter(function (bind) {\n        return bind.event === event;\n      }).map(function (bind) {\n        return bind.callback(handledPayload, ref);\n      });\n    }\n  }, {\n    key: \"replyEventName\",\n    value: function replyEventName(ref) {\n      return \"chan_reply_\" + ref;\n    }\n  }, {\n    key: \"isClosed\",\n    value: function isClosed() {\n      return this.state === CHANNEL_STATES.closed;\n    }\n  }, {\n    key: \"isErrored\",\n    value: function isErrored() {\n      return this.state === CHANNEL_STATES.errored;\n    }\n  }, {\n    key: \"isJoined\",\n    value: function isJoined() {\n      return this.state === CHANNEL_STATES.joined;\n    }\n  }, {\n    key: \"isJoining\",\n    value: function isJoining() {\n      return this.state === CHANNEL_STATES.joining;\n    }\n  }, {\n    key: \"isLeaving\",\n    value: function isLeaving() {\n      return this.state === CHANNEL_STATES.leaving;\n    }\n  }]);\n\n  return Channel;\n}();\n\nvar Socket = exports.Socket = function () {\n\n  // Initializes the Socket\n  //\n  // endPoint - The string WebSocket endpoint, ie, \"ws://example.com/ws\",\n  //                                               \"wss://example.com\"\n  //                                               \"/ws\" (inherited host & protocol)\n  // opts - Optional configuration\n  //   transport - The Websocket Transport, for example WebSocket or Phoenix.LongPoll.\n  //               Defaults to WebSocket with automatic LongPoll fallback.\n  //   encode - The function to encode outgoing messages. Defaults to JSON:\n  //\n  //     (payload, callback) => callback(JSON.stringify(payload))\n  //\n  //   decode - The function to decode incoming messages. Defaults to JSON:\n  //\n  //     (payload, callback) => callback(JSON.parse(payload))\n  //\n  //   timeout - The default timeout in milliseconds to trigger push timeouts.\n  //             Defaults `DEFAULT_TIMEOUT`\n  //   heartbeatIntervalMs - The millisec interval to send a heartbeat message\n  //   reconnectAfterMs - The optional function that returns the millsec\n  //                      reconnect interval. Defaults to stepped backoff of:\n  //\n  //     function(tries){\n  //       return [1000, 5000, 10000][tries - 1] || 10000\n  //     }\n  //\n  //   logger - The optional function for specialized logging, ie:\n  //     `logger: (kind, msg, data) => { console.log(`${kind}: ${msg}`, data) }\n  //\n  //   longpollerTimeout - The maximum timeout of a long poll AJAX request.\n  //                        Defaults to 20s (double the server long poll timer).\n  //\n  //   params - The optional params to pass when connecting\n  //\n  // For IE8 support use an ES5-shim (https://github.com/es-shims/es5-shim)\n  //\n  function Socket(endPoint) {\n    var _this4 = this;\n\n    var opts = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    _classCallCheck(this, Socket);\n\n    this.stateChangeCallbacks = { open: [], close: [], error: [], message: [] };\n    this.channels = [];\n    this.sendBuffer = [];\n    this.ref = 0;\n    this.timeout = opts.timeout || DEFAULT_TIMEOUT;\n    this.transport = opts.transport || window.WebSocket || LongPoll;\n    this.defaultEncoder = function (payload, callback) {\n      return callback(JSON.stringify(payload));\n    };\n    this.defaultDecoder = function (payload, callback) {\n      return callback(JSON.parse(payload));\n    };\n    if (this.transport !== LongPoll) {\n      this.encode = opts.encode || this.defaultEncoder;\n      this.decode = opts.decode || this.defaultDecoder;\n    } else {\n      this.encode = this.defaultEncoder;\n      this.decode = this.defaultDecoder;\n    }\n    this.heartbeatIntervalMs = opts.heartbeatIntervalMs || 30000;\n    this.reconnectAfterMs = opts.reconnectAfterMs || function (tries) {\n      return [1000, 2000, 5000, 10000][tries - 1] || 10000;\n    };\n    this.logger = opts.logger || function () {}; // noop\n    this.longpollerTimeout = opts.longpollerTimeout || 20000;\n    this.params = opts.params || {};\n    this.endPoint = endPoint + \"/\" + TRANSPORTS.websocket;\n    this.heartbeatTimer = null;\n    this.pendingHeartbeatRef = null;\n    this.reconnectTimer = new Timer(function () {\n      _this4.disconnect(function () {\n        return _this4.connect();\n      });\n    }, this.reconnectAfterMs);\n  }\n\n  _createClass(Socket, [{\n    key: \"protocol\",\n    value: function protocol() {\n      return location.protocol.match(/^https/) ? \"wss\" : \"ws\";\n    }\n  }, {\n    key: \"endPointURL\",\n    value: function endPointURL() {\n      var uri = Ajax.appendParams(Ajax.appendParams(this.endPoint, this.params), { vsn: VSN });\n      if (uri.charAt(0) !== \"/\") {\n        return uri;\n      }\n      if (uri.charAt(1) === \"/\") {\n        return this.protocol() + \":\" + uri;\n      }\n\n      return this.protocol() + \"://\" + location.host + uri;\n    }\n  }, {\n    key: \"disconnect\",\n    value: function disconnect(callback, code, reason) {\n      if (this.conn) {\n        this.conn.onclose = function () {}; // noop\n        if (code) {\n          this.conn.close(code, reason || \"\");\n        } else {\n          this.conn.close();\n        }\n        this.conn = null;\n      }\n      callback && callback();\n    }\n\n    // params - The params to send when connecting, for example `{user_id: userToken}`\n\n  }, {\n    key: \"connect\",\n    value: function connect(params) {\n      var _this5 = this;\n\n      if (params) {\n        console && console.log(\"passing params to connect is deprecated. Instead pass :params to the Socket constructor\");\n        this.params = params;\n      }\n      if (this.conn) {\n        return;\n      }\n\n      this.conn = new this.transport(this.endPointURL());\n      this.conn.timeout = this.longpollerTimeout;\n      this.conn.onopen = function () {\n        return _this5.onConnOpen();\n      };\n      this.conn.onerror = function (error) {\n        return _this5.onConnError(error);\n      };\n      this.conn.onmessage = function (event) {\n        return _this5.onConnMessage(event);\n      };\n      this.conn.onclose = function (event) {\n        return _this5.onConnClose(event);\n      };\n    }\n\n    // Logs the message. Override `this.logger` for specialized logging. noops by default\n\n  }, {\n    key: \"log\",\n    value: function log(kind, msg, data) {\n      this.logger(kind, msg, data);\n    }\n\n    // Registers callbacks for connection state change events\n    //\n    // Examples\n    //\n    //    socket.onError(function(error){ alert(\"An error occurred\") })\n    //\n\n  }, {\n    key: \"onOpen\",\n    value: function onOpen(callback) {\n      this.stateChangeCallbacks.open.push(callback);\n    }\n  }, {\n    key: \"onClose\",\n    value: function onClose(callback) {\n      this.stateChangeCallbacks.close.push(callback);\n    }\n  }, {\n    key: \"onError\",\n    value: function onError(callback) {\n      this.stateChangeCallbacks.error.push(callback);\n    }\n  }, {\n    key: \"onMessage\",\n    value: function onMessage(callback) {\n      this.stateChangeCallbacks.message.push(callback);\n    }\n  }, {\n    key: \"onConnOpen\",\n    value: function onConnOpen() {\n      var _this6 = this;\n\n      this.log(\"transport\", \"connected to \" + this.endPointURL());\n      this.flushSendBuffer();\n      this.reconnectTimer.reset();\n      if (!this.conn.skipHeartbeat) {\n        clearInterval(this.heartbeatTimer);\n        this.heartbeatTimer = setInterval(function () {\n          return _this6.sendHeartbeat();\n        }, this.heartbeatIntervalMs);\n      }\n      this.stateChangeCallbacks.open.forEach(function (callback) {\n        return callback();\n      });\n    }\n  }, {\n    key: \"onConnClose\",\n    value: function onConnClose(event) {\n      this.log(\"transport\", \"close\", event);\n      this.triggerChanError();\n      clearInterval(this.heartbeatTimer);\n      this.reconnectTimer.scheduleTimeout();\n      this.stateChangeCallbacks.close.forEach(function (callback) {\n        return callback(event);\n      });\n    }\n  }, {\n    key: \"onConnError\",\n    value: function onConnError(error) {\n      this.log(\"transport\", error);\n      this.triggerChanError();\n      this.stateChangeCallbacks.error.forEach(function (callback) {\n        return callback(error);\n      });\n    }\n  }, {\n    key: \"triggerChanError\",\n    value: function triggerChanError() {\n      this.channels.forEach(function (channel) {\n        return channel.trigger(CHANNEL_EVENTS.error);\n      });\n    }\n  }, {\n    key: \"connectionState\",\n    value: function connectionState() {\n      switch (this.conn && this.conn.readyState) {\n        case SOCKET_STATES.connecting:\n          return \"connecting\";\n        case SOCKET_STATES.open:\n          return \"open\";\n        case SOCKET_STATES.closing:\n          return \"closing\";\n        default:\n          return \"closed\";\n      }\n    }\n  }, {\n    key: \"isConnected\",\n    value: function isConnected() {\n      return this.connectionState() === \"open\";\n    }\n  }, {\n    key: \"remove\",\n    value: function remove(channel) {\n      this.channels = this.channels.filter(function (c) {\n        return c.joinRef() !== channel.joinRef();\n      });\n    }\n  }, {\n    key: \"channel\",\n    value: function channel(topic) {\n      var chanParams = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n      var chan = new Channel(topic, chanParams, this);\n      this.channels.push(chan);\n      return chan;\n    }\n  }, {\n    key: \"push\",\n    value: function push(data) {\n      var _this7 = this;\n\n      var topic = data.topic,\n          event = data.event,\n          payload = data.payload,\n          ref = data.ref;\n\n      var callback = function callback() {\n        _this7.encode(data, function (result) {\n          _this7.conn.send(result);\n        });\n      };\n      this.log(\"push\", topic + \" \" + event + \" (\" + ref + \")\", payload);\n      if (this.isConnected()) {\n        callback();\n      } else {\n        this.sendBuffer.push(callback);\n      }\n    }\n\n    // Return the next message ref, accounting for overflows\n\n  }, {\n    key: \"makeRef\",\n    value: function makeRef() {\n      var newRef = this.ref + 1;\n      if (newRef === this.ref) {\n        this.ref = 0;\n      } else {\n        this.ref = newRef;\n      }\n\n      return this.ref.toString();\n    }\n  }, {\n    key: \"sendHeartbeat\",\n    value: function sendHeartbeat() {\n      if (!this.isConnected()) {\n        return;\n      }\n      if (this.pendingHeartbeatRef) {\n        this.pendingHeartbeatRef = null;\n        this.log(\"transport\", \"heartbeat timeout. Attempting to re-establish connection\");\n        this.conn.close(WS_CLOSE_NORMAL, \"hearbeat timeout\");\n        return;\n      }\n      this.pendingHeartbeatRef = this.makeRef();\n      this.push({ topic: \"phoenix\", event: \"heartbeat\", payload: {}, ref: this.pendingHeartbeatRef });\n    }\n  }, {\n    key: \"flushSendBuffer\",\n    value: function flushSendBuffer() {\n      if (this.isConnected() && this.sendBuffer.length > 0) {\n        this.sendBuffer.forEach(function (callback) {\n          return callback();\n        });\n        this.sendBuffer = [];\n      }\n    }\n  }, {\n    key: \"onConnMessage\",\n    value: function onConnMessage(rawMessage) {\n      var _this8 = this;\n\n      this.decode(rawMessage.data, function (msg) {\n        var topic = msg.topic,\n            event = msg.event,\n            payload = msg.payload,\n            ref = msg.ref;\n\n        if (ref && ref === _this8.pendingHeartbeatRef) {\n          _this8.pendingHeartbeatRef = null;\n        }\n\n        _this8.log(\"receive\", (payload.status || \"\") + \" \" + topic + \" \" + event + \" \" + (ref && \"(\" + ref + \")\" || \"\"), payload);\n        _this8.channels.filter(function (channel) {\n          return channel.isMember(topic);\n        }).forEach(function (channel) {\n          return channel.trigger(event, payload, ref);\n        });\n        _this8.stateChangeCallbacks.message.forEach(function (callback) {\n          return callback(msg);\n        });\n      });\n    }\n  }]);\n\n  return Socket;\n}();\n\nvar LongPoll = exports.LongPoll = function () {\n  function LongPoll(endPoint) {\n    _classCallCheck(this, LongPoll);\n\n    this.endPoint = null;\n    this.token = null;\n    this.skipHeartbeat = true;\n    this.onopen = function () {}; // noop\n    this.onerror = function () {}; // noop\n    this.onmessage = function () {}; // noop\n    this.onclose = function () {}; // noop\n    this.pollEndpoint = this.normalizeEndpoint(endPoint);\n    this.readyState = SOCKET_STATES.connecting;\n\n    this.poll();\n  }\n\n  _createClass(LongPoll, [{\n    key: \"normalizeEndpoint\",\n    value: function normalizeEndpoint(endPoint) {\n      return endPoint.replace(\"ws://\", \"http://\").replace(\"wss://\", \"https://\").replace(new RegExp(\"(.*)\\/\" + TRANSPORTS.websocket), \"$1/\" + TRANSPORTS.longpoll);\n    }\n  }, {\n    key: \"endpointURL\",\n    value: function endpointURL() {\n      return Ajax.appendParams(this.pollEndpoint, { token: this.token });\n    }\n  }, {\n    key: \"closeAndRetry\",\n    value: function closeAndRetry() {\n      this.close();\n      this.readyState = SOCKET_STATES.connecting;\n    }\n  }, {\n    key: \"ontimeout\",\n    value: function ontimeout() {\n      this.onerror(\"timeout\");\n      this.closeAndRetry();\n    }\n  }, {\n    key: \"poll\",\n    value: function poll() {\n      var _this9 = this;\n\n      if (!(this.readyState === SOCKET_STATES.open || this.readyState === SOCKET_STATES.connecting)) {\n        return;\n      }\n\n      Ajax.request(\"GET\", this.endpointURL(), \"application/json\", null, this.timeout, this.ontimeout.bind(this), function (resp) {\n        if (resp) {\n          var status = resp.status,\n              token = resp.token,\n              messages = resp.messages;\n\n          _this9.token = token;\n        } else {\n          var status = 0;\n        }\n\n        switch (status) {\n          case 200:\n            messages.forEach(function (msg) {\n              return _this9.onmessage({ data: JSON.stringify(msg) });\n            });\n            _this9.poll();\n            break;\n          case 204:\n            _this9.poll();\n            break;\n          case 410:\n            _this9.readyState = SOCKET_STATES.open;\n            _this9.onopen();\n            _this9.poll();\n            break;\n          case 0:\n          case 500:\n            _this9.onerror();\n            _this9.closeAndRetry();\n            break;\n          default:\n            throw \"unhandled poll status \" + status;\n        }\n      });\n    }\n  }, {\n    key: \"send\",\n    value: function send(body) {\n      var _this10 = this;\n\n      Ajax.request(\"POST\", this.endpointURL(), \"application/json\", body, this.timeout, this.onerror.bind(this, \"timeout\"), function (resp) {\n        if (!resp || resp.status !== 200) {\n          _this10.onerror(resp && resp.status);\n          _this10.closeAndRetry();\n        }\n      });\n    }\n  }, {\n    key: \"close\",\n    value: function close(code, reason) {\n      this.readyState = SOCKET_STATES.closed;\n      this.onclose();\n    }\n  }]);\n\n  return LongPoll;\n}();\n\nvar Ajax = exports.Ajax = function () {\n  function Ajax() {\n    _classCallCheck(this, Ajax);\n  }\n\n  _createClass(Ajax, null, [{\n    key: \"request\",\n    value: function request(method, endPoint, accept, body, timeout, ontimeout, callback) {\n      if (window.XDomainRequest) {\n        var req = new XDomainRequest(); // IE8, IE9\n        this.xdomainRequest(req, method, endPoint, body, timeout, ontimeout, callback);\n      } else {\n        var _req = window.XMLHttpRequest ? new window.XMLHttpRequest() : // IE7+, Firefox, Chrome, Opera, Safari\n        new ActiveXObject(\"Microsoft.XMLHTTP\"); // IE6, IE5\n        this.xhrRequest(_req, method, endPoint, accept, body, timeout, ontimeout, callback);\n      }\n    }\n  }, {\n    key: \"xdomainRequest\",\n    value: function xdomainRequest(req, method, endPoint, body, timeout, ontimeout, callback) {\n      var _this11 = this;\n\n      req.timeout = timeout;\n      req.open(method, endPoint);\n      req.onload = function () {\n        var response = _this11.parseJSON(req.responseText);\n        callback && callback(response);\n      };\n      if (ontimeout) {\n        req.ontimeout = ontimeout;\n      }\n\n      // Work around bug in IE9 that requires an attached onprogress handler\n      req.onprogress = function () {};\n\n      req.send(body);\n    }\n  }, {\n    key: \"xhrRequest\",\n    value: function xhrRequest(req, method, endPoint, accept, body, timeout, ontimeout, callback) {\n      var _this12 = this;\n\n      req.open(method, endPoint, true);\n      req.timeout = timeout;\n      req.setRequestHeader(\"Content-Type\", accept);\n      req.onerror = function () {\n        callback && callback(null);\n      };\n      req.onreadystatechange = function () {\n        if (req.readyState === _this12.states.complete && callback) {\n          var response = _this12.parseJSON(req.responseText);\n          callback(response);\n        }\n      };\n      if (ontimeout) {\n        req.ontimeout = ontimeout;\n      }\n\n      req.send(body);\n    }\n  }, {\n    key: \"parseJSON\",\n    value: function parseJSON(resp) {\n      if (!resp || resp === \"\") {\n        return null;\n      }\n\n      try {\n        return JSON.parse(resp);\n      } catch (e) {\n        console && console.log(\"failed to parse JSON response\", resp);\n        return null;\n      }\n    }\n  }, {\n    key: \"serialize\",\n    value: function serialize(obj, parentKey) {\n      var queryStr = [];\n      for (var key in obj) {\n        if (!obj.hasOwnProperty(key)) {\n          continue;\n        }\n        var paramKey = parentKey ? parentKey + \"[\" + key + \"]\" : key;\n        var paramVal = obj[key];\n        if ((typeof paramVal === \"undefined\" ? \"undefined\" : _typeof(paramVal)) === \"object\") {\n          queryStr.push(this.serialize(paramVal, paramKey));\n        } else {\n          queryStr.push(encodeURIComponent(paramKey) + \"=\" + encodeURIComponent(paramVal));\n        }\n      }\n      return queryStr.join(\"&\");\n    }\n  }, {\n    key: \"appendParams\",\n    value: function appendParams(url, params) {\n      if (Object.keys(params).length === 0) {\n        return url;\n      }\n\n      var prefix = url.match(/\\?/) ? \"&\" : \"?\";\n      return \"\" + url + prefix + this.serialize(params);\n    }\n  }]);\n\n  return Ajax;\n}();\n\nAjax.states = { complete: 4 };\n\nvar Presence = exports.Presence = {\n  syncState: function syncState(currentState, newState, onJoin, onLeave) {\n    var _this13 = this;\n\n    var state = this.clone(currentState);\n    var joins = {};\n    var leaves = {};\n\n    this.map(state, function (key, presence) {\n      if (!newState[key]) {\n        leaves[key] = presence;\n      }\n    });\n    this.map(newState, function (key, newPresence) {\n      var currentPresence = state[key];\n      if (currentPresence) {\n        var newRefs = newPresence.metas.map(function (m) {\n          return m.phx_ref;\n        });\n        var curRefs = currentPresence.metas.map(function (m) {\n          return m.phx_ref;\n        });\n        var joinedMetas = newPresence.metas.filter(function (m) {\n          return curRefs.indexOf(m.phx_ref) < 0;\n        });\n        var leftMetas = currentPresence.metas.filter(function (m) {\n          return newRefs.indexOf(m.phx_ref) < 0;\n        });\n        if (joinedMetas.length > 0) {\n          joins[key] = newPresence;\n          joins[key].metas = joinedMetas;\n        }\n        if (leftMetas.length > 0) {\n          leaves[key] = _this13.clone(currentPresence);\n          leaves[key].metas = leftMetas;\n        }\n      } else {\n        joins[key] = newPresence;\n      }\n    });\n    return this.syncDiff(state, { joins: joins, leaves: leaves }, onJoin, onLeave);\n  },\n  syncDiff: function syncDiff(currentState, _ref2, onJoin, onLeave) {\n    var joins = _ref2.joins,\n        leaves = _ref2.leaves;\n\n    var state = this.clone(currentState);\n    if (!onJoin) {\n      onJoin = function onJoin() {};\n    }\n    if (!onLeave) {\n      onLeave = function onLeave() {};\n    }\n\n    this.map(joins, function (key, newPresence) {\n      var currentPresence = state[key];\n      state[key] = newPresence;\n      if (currentPresence) {\n        var _state$key$metas;\n\n        (_state$key$metas = state[key].metas).unshift.apply(_state$key$metas, _toConsumableArray(currentPresence.metas));\n      }\n      onJoin(key, currentPresence, newPresence);\n    });\n    this.map(leaves, function (key, leftPresence) {\n      var currentPresence = state[key];\n      if (!currentPresence) {\n        return;\n      }\n      var refsToRemove = leftPresence.metas.map(function (m) {\n        return m.phx_ref;\n      });\n      currentPresence.metas = currentPresence.metas.filter(function (p) {\n        return refsToRemove.indexOf(p.phx_ref) < 0;\n      });\n      onLeave(key, currentPresence, leftPresence);\n      if (currentPresence.metas.length === 0) {\n        delete state[key];\n      }\n    });\n    return state;\n  },\n  list: function list(presences, chooser) {\n    if (!chooser) {\n      chooser = function chooser(key, pres) {\n        return pres;\n      };\n    }\n\n    return this.map(presences, function (key, presence) {\n      return chooser(key, presence);\n    });\n  },\n\n\n  // private\n\n  map: function map(obj, func) {\n    return Object.getOwnPropertyNames(obj).map(function (key) {\n      return func(key, obj[key]);\n    });\n  },\n  clone: function clone(obj) {\n    return JSON.parse(JSON.stringify(obj));\n  }\n};\n\n// Creates a timer that accepts a `timerCalc` function to perform\n// calculated timeout retries, such as exponential backoff.\n//\n// ## Examples\n//\n//    let reconnectTimer = new Timer(() => this.connect(), function(tries){\n//      return [1000, 5000, 10000][tries - 1] || 10000\n//    })\n//    reconnectTimer.scheduleTimeout() // fires after 1000\n//    reconnectTimer.scheduleTimeout() // fires after 5000\n//    reconnectTimer.reset()\n//    reconnectTimer.scheduleTimeout() // fires after 1000\n//\n\nvar Timer = function () {\n  function Timer(callback, timerCalc) {\n    _classCallCheck(this, Timer);\n\n    this.callback = callback;\n    this.timerCalc = timerCalc;\n    this.timer = null;\n    this.tries = 0;\n  }\n\n  _createClass(Timer, [{\n    key: \"reset\",\n    value: function reset() {\n      this.tries = 0;\n      clearTimeout(this.timer);\n    }\n\n    // Cancels any previous scheduleTimeout and schedules callback\n\n  }, {\n    key: \"scheduleTimeout\",\n    value: function scheduleTimeout() {\n      var _this14 = this;\n\n      clearTimeout(this.timer);\n\n      this.timer = setTimeout(function () {\n        _this14.tries = _this14.tries + 1;\n        _this14.callback();\n      }, this.timerCalc(this.tries + 1));\n    }\n  }]);\n\n  return Timer;\n}();\n\n})));\n\n\n\n// WEBPACK FOOTER //\n// ./src/phoenix.js"],"sourceRoot":""}